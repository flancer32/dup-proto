{
  "package": {
    "app": {
      "entity": {
        "cfg": {
          "comment": "Configuration data for this application.",
          "attr": {
            "key": {
              "comment": "Path to current config value (/path/to/option)",
              "type": "string"
            },
            "value": {
              "comment": "Any value stored as text.",
              "type": "text"
            }
          },
          "index": {
            "PK": {"type": "primary", "attrs": ["key"]}
          }
        },
        "user": {
          "comment": "User data in this app.",
          "attr": {
            "user_ref": {"type": "ref"},
            "nick": {"type": "string"},
            "key_pub": {"type": "text"}
          },
          "index": {
            "PK": {"type": "primary", "attrs": ["user_ref"]}
          },
          "relation": {
            "user": {
              "attrs": ["user_ref"],
              "ref": {"path": "/user", "attrs": ["id"]},
              "action": {"delete": "cascade", "update": "cascade"}
            }
          }
        }
      },
      "package": {
        "user": {
          "entity": {
            "invite": {
              "comment": "Invitation codes for users registration.",
              "attr": {
                "code": {"type": "string"},
                "user_ref": {"type": "ref"},
                "onetime": {"type": "boolean"},
                "date_expired": {"type": "datetime"}
              },
              "index": {
                "PK": {"type": "primary", "attrs": ["code"]}
              },
              "relation": {
                "user": {
                  "attrs": ["user_ref"],
                  "ref": {"path": "/user", "attrs": ["id"]},
                  "action": {"delete": "cascade", "update": "cascade"}
                }
              }
            },
            "tree": {
              "comment": "Users relations (parent - child).",
              "attr": {
                "user_ref": {"type": "ref"},
                "parent_ref": {"type": "ref"}
              },
              "index": {
                "PK": {"type": "primary", "attrs": ["user_ref"]}
              },
              "relation": {
                "user": {
                  "attrs": ["user_ref"],
                  "ref": {"path": "/user", "attrs": ["id"]},
                  "action": {"delete": "cascade", "update": "cascade"}
                },
                "parent": {
                  "attrs": ["parent_ref"],
                  "ref": {"path": "/app/user/tree", "attrs": ["user_ref"]},
                  "action": {"delete": "cascade", "update": "cascade"}
                }
              }
            }
          }
        }
      }
    },
    "queue": {
      "package": {
        "msg": {
          "entity": {
            "user": {
              "comment": "Personal messages queue (from user to user).",
              "attr": {
                "id": {"type": "id"},
                "sender_ref": {"type": "ref"},
                "receiver_ref": {"type": "ref"},
                "date": {
                  "comment": "Date for registration in the queue.",
                  "type": "datetime",
                  "default": "current"
                },
                "state": {
                  "comment": "Should be enum ir removed.",
                  "type": "string"
                },
                "payload": {
                  "comment": "Encrypted and base64 encoded message.",
                  "type": "text"
                }
              },
              "relation": {
                "sender": {
                  "attrs": ["sender_ref"],
                  "ref": {"path": "/user", "attrs": ["id"]},
                  "action": {"delete": "cascade", "update": "cascade"}
                },
                "receiver": {
                  "attrs": ["receiver_ref"],
                  "ref": {"path": "/user", "attrs": ["id"]},
                  "action": {"delete": "cascade", "update": "cascade"}
                }
              }
            }
          }
        }
      }
    }
  },
  "refs": {
    "/user": ["id"]
  }
}
